var pw=(()=>{var T=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var w=(d,e)=>{for(var t in e)T(d,t,{get:e[t],enumerable:!0})},O=(d,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of x(e))!S.call(d,a)&&a!==t&&T(d,a,{get:()=>e[a],enumerable:!(n=H(e,a))||n.enumerable});return d};var C=d=>O(T({},"__esModule",{value:!0}),d);var L={};w(L,{pw:()=>I});var G=d=>{throw Error(d)},N=class d{readAsElement(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);let a=n.getImageData(0,0,t.width,t.height);return new g(a)}async readAsDataUrl(e){e||G("no url\uFF01");try{let t=await d.resolveWithUrl(e);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}async readAsData(e){e.size||G("no content blob");let t=URL.createObjectURL(e);try{let n=await d.resolveWithUrl(t);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}fade(e,t,n){let r=(t==="in"?1-n:n)*255,o=r,c=r,s=r;switch(t){case"in":e.recycle((i,h,l)=>{let[M,R,u]=i;M+R+u>o+c+s&&(e.update(h,l,"R",255),e.update(h,l,"G",255),e.update(h,l,"B",255))});break;case"out":e.recycle((i,h,l)=>{let[M,R,u]=i;M+R+u<o+c+s&&(e.update(h,l,"R",255),e.update(h,l,"G",255),e.update(h,l,"B",255))});break}}native(e,t="#000000"){let n=t.slice(1),[a,r,o]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];e.recycle((c,s,i)=>{let[h,l,M]=c;(h!==255||l!==255||M!==255)&&(e.update(s,i,"R",a),e.update(s,i,"G",r),e.update(s,i,"B",o))})}nativeRollback(e){let t=[0,0,0,0];e.recycle(n=>{let[a,r,o]=n;if(a!==255||r!==255||o!==255)return t[0]=a,t[1]=r,t[2]=o,"break"}),e.recycle((n,a,r)=>{let[o,c,s]=n;o===t[0]&&c===t[1]&&s===t[2]?(e.update(a,r,"R",255),e.update(a,r,"G",255),e.update(a,r,"B",255)):(e.update(a,r,"R",t[0]),e.update(a,r,"G",t[1]),e.update(a,r,"B",t[2]))})}dropTransparent(e,t="#FFFFFFff"){let n=t.slice(1),[a,r,o,c]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];e.recycle((s,i,h)=>{s[3]===0&&(e.update(i,h,"R",a),e.update(i,h,"G",r),e.update(i,h,"B",o),e.update(i,h,"A",c))})}colorRollback(e){e.recycle((t,n,a)=>{let[r,o,c,s]=t;e.update(n,a,"R",255-r),e.update(n,a,"G",255-o),e.update(n,a,"B",255-c),e.update(n,a,"A",255-s)})}gray(e){e.recycle((t,n,a)=>{let[r,o,c]=t,s=Math.floor(d.rgbToGray(r,o,c));e.update(n,a,"R",s),e.update(n,a,"G",s),e.update(n,a,"B",s)})}medianBlur(e,t){t%2!==1&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=-Math.floor(t/2),a=Math.abs(n);e.recycle((r,o,c)=>{let s={R:[],G:[],B:[],A:[]};for(let u=n;u<=a;u++){let p=o+u;if(!(p<0||p>=e.rows))for(let f=n;f<=a;f++){let B=c+f;if(B<0||B>=e.cols)continue;let[b,A,E,y]=e.at(p,B);s.R.push(b),s.G.push(A),s.B.push(E),s.A.push(y)}}s.R.sort((u,p)=>u-p),s.G.sort((u,p)=>u-p),s.B.sort((u,p)=>u-p),s.A.sort((u,p)=>u-p);let i=s.R.length%2!==0,h,l,M,R;if(i){let{R:u,G:p,B:f,A:B}=s,b=Math.floor(u.length/2);h=u[b],l=p[b],M=f[b],R=B[b]}else{let{R:u,G:p,B:f,A:B}=s,b=u.length/2,A=b-1;h=Math.round((u[b]+u[A])/2),l=Math.round((p[b]+p[A])/2),M=Math.round((f[b]+f[A])/2),R=Math.round((B[b]+B[A])/2)}e.update(o,c,"R",h),e.update(o,c,"G",l),e.update(o,c,"B",M)})}gaussianBlur(e,t,n=0,a=n){t%2===0&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((t-1)/2-1)+.8),(!a||a===0)&&(a=n);let r=d.calcGaussianKernel(t,n,a);if(!r.length)return;let o=Math.floor(t/2);e.recycle((c,s,i)=>{let h=0,l=0,M=0,R=0;for(let u=0;u<t;u++)for(let p=0;p<t;p++){let f=s+u-o,B=i+p-o;f=Math.max(f,0),f=Math.min(f,e.rows-1),B=Math.max(B,0),B=Math.min(B,e.cols-1);let b=r[u][p],[A,E,y,m]=e.at(f,B);h+=A*b,l+=E*b,M+=y*b,R+=m*b}e.update(s,i,"R",Math.round(h)),e.update(s,i,"G",Math.round(l)),e.update(s,i,"B",Math.round(M)),e.update(s,i,"A",Math.round(R))})}meanBlur(e,t){t%2===0&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=Math.floor(t/2),a=Math.pow(t,2);e.recycle((r,o,c)=>{let s=0,i=0,h=0,l=0;for(let M=0;M<t;M++)for(let R=0;R<t;R++){let u=o+M-n,p=c+R-n;u=Math.max(u,0),u=Math.min(u,e.rows-1),p=Math.max(p,0),p=Math.min(p,e.cols-1);let[f,B,b,A]=e.at(u,p);s+=f,i+=B,h+=b,l+=A}e.update(o,c,"R",Math.round(s/a)),e.update(o,c,"G",Math.round(i/a)),e.update(o,c,"B",Math.round(h/a)),e.update(o,c,"A",Math.round(l/a))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(e,t){if(arguments.length===1||!t?.length){t=new Uint8ClampedArray(256);for(let n=0;n<256;n++)t[n]=Math.min(255,Math.floor(n*d.SATURATION_CONTRAST))}e.recycle((n,a,r)=>{let[o,c,s]=n;e.update(a,r,"R",t[o]),e.update(a,r,"G",t[c]),e.update(a,r,"B",t[s])})}threshold(e,t,n,a=d.THRESH_BINARY,r=d.THRESH_MODE_THRESHOLD){e.recycle((o,c,s)=>{let[i,h,l]=e.at(c,s),M=d.rgbToGray(i,h,l),R;switch(r){case d.THRESH_MODE_THRESHOLD:R=d.calcThresholdValue(M,t,n,a);break;case d.THRESH_MODE_OTSU:R=d.calcThresholdValue(M,d.calcOtsuThreshold(e),n,a);break;case d.THRESH_MODE_MANUAL:R=d.calcThresholdValue(M,t,n,a);break}e.update(c,s,"R",R),e.update(c,s,"G",R),e.update(c,s,"B",R)})}dropWhite(e){e.recycle((t,n,a)=>{let[r,o,c,s]=t;r===255&&o===255&&c===255&&s!==0&&e.update(n,a,"A",0)})}groundGlassFilter(e,t=5,n=!0){(!t||t<=0)&&G("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");let{rows:a,cols:r}=e,o=a-t,c=r-t;for(let s=0;s<o;s++)for(let i=0;i<c;i++){let h=Math.floor(Math.random()*t),l=s+h,M=i+(n?h:Math.floor(Math.random()*t)),[R,u,p,f]=e.at(l,M);e.update(s,i,"R",R),e.update(s,i,"G",u),e.update(s,i,"B",p),e.update(s,i,"A",f)}}nostalgiaFilter(e){e.recycle((t,n,a)=>{let[r,o,c]=t,s=Math.min(.393*r+.769*o+.189*c,255),i=Math.min(.349*r+.686*o+.168*c,255),h=Math.min(.272*r+.534*o+.131*c,255);e.update(n,a,"R",s),e.update(n,a,"G",i),e.update(n,a,"B",h)})}fleetingFilter(e,t=12){t=Math.round(t),t<=0&&G("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),e.recycle((n,a,r)=>{let o=n[2],c=Math.sqrt(o)*t;e.update(a,r,"B",c)})}sunLightFilter(e,t,n,a,r=200){let{rows:o,cols:c}=e;t=t||Math.floor(o/2),n=n||Math.floor(c/2),a=a||Math.min(o,c),e.recycle((s,i,h)=>{let l=Math.pow(t-i,2)+Math.pow(n-h,2);if(l<Math.pow(a,2)){let[M,R,u]=s,p=Math.round(r*(1-Math.sqrt(l)/a));e.update(i,h,"R",Math.min(255,Math.max(0,M+p))),e.update(i,h,"G",Math.min(255,Math.max(0,R+p))),e.update(i,h,"B",Math.min(255,Math.max(0,u+p)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(e,t,n){return e*d.GRAY_SCALE_RED+t*d.GRAY_SCALE_GREEN+n*d.GRAY_SCALE_BLUE}static resolveWithUrl(e){return new Promise((t,n)=>{let a=new Image;a.addEventListener("load",()=>{let r=document.createElement("canvas");r.width=a.width,r.height=a.height;let o=r.getContext("2d");o.drawImage(a,0,0,r.width,r.height);let c=o.getImageData(0,0,r.width,r.height);t(new g(c)),a.remove(),r.remove()}),a.addEventListener("error",(...r)=>{n(r[1])}),a.setAttribute("src",e)})}static gaussianFunction(e,t,n,a){let r=-(e*e/(2*n*n)),o=-(t*t/(2*a*a));return 1/(2*Math.PI*n*a)*Math.exp(r+o)}static calcGaussianKernel(e,t,n){let a=[],r=Math.floor(e/2),o=0;for(let c=-r;c<=r;c++){let s=r+c;a[s]=[];for(let i=-r;i<=r;i++){let h=r+i,l=d.gaussianFunction(c,i,t,n);a[s][h]=l,o+=l}}for(let c=0;c<e;c++)for(let s=0;s<e;s++)a[c][s]/=o;return a}static THRESH_BINARY=1;static THRESH_BINARY_INV=2;static THRESH_TRUNC=3;static THRESH_TOZERO=4;static THRESH_TOZERO_INV=5;static THRESH_MODE_THRESHOLD=1;static THRESH_MODE_OTSU=2;static THRESH_MODE_MANUAL=3;static calcThresholdValue(e,t,n,a){let r;switch(a){case d.THRESH_BINARY:r=e<t?0:n;break;case d.THRESH_BINARY_INV:r=e<t?n:0;break;case d.THRESH_TRUNC:r=e<t?e:t;break;case d.THRESH_TOZERO:r=e<t?0:e;break;case d.THRESH_TOZERO_INV:r=e<t?e:0;break}return r}static calcOtsuThreshold(e){let t=new Array(256).fill(0),n=0;e.recycle((c,s,i)=>{let[h,l,M]=c,R=d.rgbToGray(h,l,M);t[Math.floor(R)]++,n++});let a=t.map(c=>c/n),r=0,o=0;for(let c=0;c<256;c++){let s=a.slice(0,c+1).reduce((R,u)=>R+u,0),i=1-s,h=a.slice(0,c+1).map((R,u)=>u*R).reduce((R,u)=>R+u,0),l=a.slice(c+1).map((R,u)=>u*R).reduce((R,u)=>R+u,0),M=s*i*Math.pow(h/s-l/i,2);M>o&&(o=M,r=c)}return r}},g=class d{rows;cols;channels;size;data;constructor(e){this.rows=e.height,this.cols=e.width,this.size={width:e.width,height:e.height},this.channels=4,this.data=e.data}clone(){let{data:e,size:{width:t,height:n}}=this,a=new Uint8ClampedArray(e),r=new ImageData(a,t,n);return new d(r)}delete(){this.data=new Uint8ClampedArray(0)}update(e,t,n,a){let{data:r}=this,[o,c,s,i]=this.getAddress(e,t);switch(n){case"R":r[o]=a;break;case"G":r[c]=a;break;case"B":r[s]=a;break;case"A":r[i]=a;break}}getAddress(e,t){let{channels:n,cols:a}=this,r=a*e*n+t*n;return[r,r+1,r+2,r+3]}recycle(e){let{rows:t,cols:n}=this;for(let a=0;a<t;a++)for(let r=0;r<n;r++)e(this.at(a,r),a,r)}at(e,t){let{data:n}=this,[a,r,o,c]=this.getAddress(e,t);return[n[a],n[r],n[o],n[c]]}imgshow(e,t=!1,n=0,a=0){let r=e instanceof HTMLCanvasElement?e:document.querySelector(e);r||G("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");let{data:o,size:c}=this,{width:s,height:i}=c,h=new ImageData(o,s,i),l=r.getContext("2d");t?(r.width=n,r.height=a,window.createImageBitmap(h,{resizeHeight:a,resizeWidth:n}).then(M=>{l.drawImage(M,0,0)})):(r.width=s,r.height=i,l.putImageData(h,0,0,0,0,r.width,r.height))}toDataUrl(e,t=1){let n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(e??"image/png",t)}toBlob(e,t=1){return new Promise((n,a)=>{let r=document.createElement("canvas");this.imgshow(r),r.toBlob(o=>{if(!o||!o.size)return a(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(o)},e??"image/png",t)})}},I=new N;return C(L);})();
