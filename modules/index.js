var pw=(()=>{var g=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var K=(R,e)=>{for(var t in e)g(R,t,{get:e[t],enumerable:!0})},W=(R,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of z(e))!q.call(R,a)&&a!==t&&g(R,a,{get:()=>e[a],enumerable:!(n=j(e,a))||n.enumerable});return R};var J=R=>W(g({},"__esModule",{value:!0}),R);var X={};K(X,{pw:()=>Q});var G=R=>{throw Error(R)},_=class R{readAsElement(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);let a=n.getImageData(0,0,t.width,t.height);return new N(a)}async readAsDataUrl(e){e||G("no url\uFF01");try{let t=await R.resolveWithUrl(e);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}async readAsData(e){e.size||G("no content blob");let t=URL.createObjectURL(e);try{let n=await R.resolveWithUrl(t);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}static calcResizeLinerFunc(e,t,n,a,s,r){return(1-s)*(1-r)*e+s*(1-r)*t+(1-s)*r*n+s*r*a}RESIZE={INTER_NEAREST:1,INTER_LINEAR:2,INTER_CUBIC:3,INTER_AREA:4,INTER_LANCZOS4:5};resize(e,t,n,a=this.RESIZE.INTER_LINEAR){let s=new ImageData(new Uint8ClampedArray(n*t*4),t,n),r=new N(s),{size:{width:o,height:c}}=e,i=o/t,h=c/n;switch(a){case this.RESIZE.INTER_NEAREST:return r.recycle((p,l,d)=>{let u=Math.round(l*i),M=Math.round(d*h),[E,A,b,f]=e.at(u,M);r.update(l,d,"R",E),r.update(l,d,"G",A),r.update(l,d,"B",b),r.update(l,d,"A",f)}),r;case this.RESIZE.INTER_LINEAR:return r.recycle((p,l,d)=>{let u=(l+.5)*i-.5,M=(d+.5)*h-.5,E=Math.floor(u),A=Math.floor(M),b=Math.ceil(u),f=Math.ceil(M),B=u-E,y=M-A,[T,x,m,I]=e.at(E,A),[S,H,C,L]=e.at(b,A),[O,w,U,D]=e.at(E,f),[F,v,k,Z]=e.at(b,f),P=R.calcResizeLinerFunc(T,S,O,F,B,y),Y=R.calcResizeLinerFunc(x,H,w,v,B,y),V=R.calcResizeLinerFunc(m,C,U,k,B,y),$=R.calcResizeLinerFunc(I,L,D,Z,B,y);r.update(l,d,"R",P),r.update(l,d,"G",Y),r.update(l,d,"B",V),r.update(l,d,"A",$)}),r;case this.RESIZE.INTER_CUBIC:return r;case this.RESIZE.INTER_AREA:return r;case this.RESIZE.INTER_LANCZOS4:return r}}fade(e,t,n){let s=(t==="in"?1-n:n)*255,r=s,o=s,c=s;switch(t){case"in":e.recycle((i,h,p)=>{let[l,d,u]=i;l+d+u>r+o+c&&(e.update(h,p,"R",255),e.update(h,p,"G",255),e.update(h,p,"B",255))});break;case"out":e.recycle((i,h,p)=>{let[l,d,u]=i;l+d+u<r+o+c&&(e.update(h,p,"R",255),e.update(h,p,"G",255),e.update(h,p,"B",255))});break}}native(e,t="#000000"){let n=t.slice(1),[a,s,r]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];e.recycle((o,c,i)=>{let[h,p,l]=o;(h!==255||p!==255||l!==255)&&(e.update(c,i,"R",a),e.update(c,i,"G",s),e.update(c,i,"B",r))})}nativeRollback(e){let t=[0,0,0,0];e.recycle(n=>{let[a,s,r]=n;if(a!==255||s!==255||r!==255)return t[0]=a,t[1]=s,t[2]=r,"break"}),e.recycle((n,a,s)=>{let[r,o,c]=n;r===t[0]&&o===t[1]&&c===t[2]?(e.update(a,s,"R",255),e.update(a,s,"G",255),e.update(a,s,"B",255)):(e.update(a,s,"R",t[0]),e.update(a,s,"G",t[1]),e.update(a,s,"B",t[2]))})}dropTransparent(e,t="#FFFFFFff"){let n=t.slice(1),[a,s,r,o]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];e.recycle((c,i,h)=>{c[3]===0&&(e.update(i,h,"R",a),e.update(i,h,"G",s),e.update(i,h,"B",r),e.update(i,h,"A",o))})}colorRollback(e){e.recycle((t,n,a)=>{let[s,r,o,c]=t;e.update(n,a,"R",255-s),e.update(n,a,"G",255-r),e.update(n,a,"B",255-o),e.update(n,a,"A",255-c)})}gray(e){e.recycle((t,n,a)=>{let[s,r,o]=t,c=Math.floor(R.rgbToGray(s,r,o));e.update(n,a,"R",c),e.update(n,a,"G",c),e.update(n,a,"B",c)})}medianBlur(e,t){t%2!==1&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=-Math.floor(t/2),a=Math.abs(n);e.recycle((s,r,o)=>{let c={R:[],G:[],B:[],A:[]};for(let u=n;u<=a;u++){let M=r+u;if(!(M<0||M>=e.rows))for(let E=n;E<=a;E++){let A=o+E;if(A<0||A>=e.cols)continue;let[b,f,B,y]=e.at(M,A);c.R.push(b),c.G.push(f),c.B.push(B),c.A.push(y)}}c.R.sort((u,M)=>u-M),c.G.sort((u,M)=>u-M),c.B.sort((u,M)=>u-M),c.A.sort((u,M)=>u-M);let i=c.R.length%2!==0,h,p,l,d;if(i){let{R:u,G:M,B:E,A}=c,b=Math.floor(u.length/2);h=u[b],p=M[b],l=E[b],d=A[b]}else{let{R:u,G:M,B:E,A}=c,b=u.length/2,f=b-1;h=Math.round((u[b]+u[f])/2),p=Math.round((M[b]+M[f])/2),l=Math.round((E[b]+E[f])/2),d=Math.round((A[b]+A[f])/2)}e.update(r,o,"R",h),e.update(r,o,"G",p),e.update(r,o,"B",l)})}gaussianBlur(e,t,n=0,a=n){t%2===0&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((t-1)/2-1)+.8),(!a||a===0)&&(a=n);let s=R.calcGaussianKernel(t,n,a);if(!s.length)return;let r=Math.floor(t/2);e.recycle((o,c,i)=>{let h=0,p=0,l=0,d=0;for(let u=0;u<t;u++)for(let M=0;M<t;M++){let E=c+u-r,A=i+M-r;E=Math.max(E,0),E=Math.min(E,e.rows-1),A=Math.max(A,0),A=Math.min(A,e.cols-1);let b=s[u][M],[f,B,y,T]=e.at(E,A);h+=f*b,p+=B*b,l+=y*b,d+=T*b}e.update(c,i,"R",Math.round(h)),e.update(c,i,"G",Math.round(p)),e.update(c,i,"B",Math.round(l)),e.update(c,i,"A",Math.round(d))})}meanBlur(e,t){t%2===0&&G("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=Math.floor(t/2),a=Math.pow(t,2);e.recycle((s,r,o)=>{let c=0,i=0,h=0,p=0;for(let l=0;l<t;l++)for(let d=0;d<t;d++){let u=r+l-n,M=o+d-n;u=Math.max(u,0),u=Math.min(u,e.rows-1),M=Math.max(M,0),M=Math.min(M,e.cols-1);let[E,A,b,f]=e.at(u,M);c+=E,i+=A,h+=b,p+=f}e.update(r,o,"R",Math.round(c/a)),e.update(r,o,"G",Math.round(i/a)),e.update(r,o,"B",Math.round(h/a)),e.update(r,o,"A",Math.round(p/a))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(e,t){if(arguments.length===1||!t?.length){t=new Uint8ClampedArray(256);for(let n=0;n<256;n++)t[n]=Math.min(255,Math.floor(n*R.SATURATION_CONTRAST))}e.recycle((n,a,s)=>{let[r,o,c]=n;e.update(a,s,"R",t[r]),e.update(a,s,"G",t[o]),e.update(a,s,"B",t[c])})}threshold(e,t,n,a=R.THRESH_BINARY,s=R.THRESH_MODE_THRESHOLD){e.recycle((r,o,c)=>{let[i,h,p]=e.at(o,c),l=R.rgbToGray(i,h,p),d;switch(s){case R.THRESH_MODE_THRESHOLD:d=R.calcThresholdValue(l,t,n,a);break;case R.THRESH_MODE_OTSU:d=R.calcThresholdValue(l,R.calcOtsuThreshold(e),n,a);break;case R.THRESH_MODE_MANUAL:d=R.calcThresholdValue(l,t,n,a);break}e.update(o,c,"R",d),e.update(o,c,"G",d),e.update(o,c,"B",d)})}dropWhite(e){e.recycle((t,n,a)=>{let[s,r,o,c]=t;s===255&&r===255&&o===255&&c!==0&&e.update(n,a,"A",0)})}groundGlassFilter(e,t=5,n=!0){(!t||t<=0)&&G("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");let{rows:a,cols:s}=e,r=a-t,o=s-t;for(let c=0;c<r;c++)for(let i=0;i<o;i++){let h=Math.floor(Math.random()*t),p=c+h,l=i+(n?h:Math.floor(Math.random()*t)),[d,u,M,E]=e.at(p,l);e.update(c,i,"R",d),e.update(c,i,"G",u),e.update(c,i,"B",M),e.update(c,i,"A",E)}}nostalgiaFilter(e){e.recycle((t,n,a)=>{let[s,r,o]=t,c=Math.min(.393*s+.769*r+.189*o,255),i=Math.min(.349*s+.686*r+.168*o,255),h=Math.min(.272*s+.534*r+.131*o,255);e.update(n,a,"R",c),e.update(n,a,"G",i),e.update(n,a,"B",h)})}fleetingFilter(e,t=12){t=Math.round(t),t<=0&&G("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),e.recycle((n,a,s)=>{let r=n[2],o=Math.sqrt(r)*t;e.update(a,s,"B",o)})}sunLightFilter(e,t,n,a,s=150){let{rows:r,cols:o}=e;t=t||Math.floor(r/2),n=n||Math.floor(o/2),a=a||Math.min(r,o),e.recycle((c,i,h)=>{let p=Math.pow(t-i,2)+Math.pow(n-h,2);if(p<Math.pow(a,2)){let[l,d,u]=c,M=Math.round(s*(1-Math.sqrt(p)/a));e.update(i,h,"R",Math.min(255,Math.max(0,l+M))),e.update(i,h,"G",Math.min(255,Math.max(0,d+M))),e.update(i,h,"B",Math.min(255,Math.max(0,u+M)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(e,t,n){return e*R.GRAY_SCALE_RED+t*R.GRAY_SCALE_GREEN+n*R.GRAY_SCALE_BLUE}static resolveWithUrl(e){return new Promise((t,n)=>{let a=new Image;a.addEventListener("load",()=>{let s=document.createElement("canvas");s.width=a.width,s.height=a.height;let r=s.getContext("2d");r.drawImage(a,0,0,s.width,s.height);let o=r.getImageData(0,0,s.width,s.height);t(new N(o)),a.remove(),s.remove()}),a.addEventListener("error",(...s)=>{n(s[1])}),a.setAttribute("src",e)})}static gaussianFunction(e,t,n,a){let s=-(e*e/(2*n*n)),r=-(t*t/(2*a*a));return 1/(2*Math.PI*n*a)*Math.exp(s+r)}static calcGaussianKernel(e,t,n){let a=[],s=Math.floor(e/2),r=0;for(let o=-s;o<=s;o++){let c=s+o;a[c]=[];for(let i=-s;i<=s;i++){let h=s+i,p=R.gaussianFunction(o,i,t,n);a[c][h]=p,r+=p}}for(let o=0;o<e;o++)for(let c=0;c<e;c++)a[o][c]/=r;return a}static THRESH_BINARY=1;static THRESH_BINARY_INV=2;static THRESH_TRUNC=3;static THRESH_TOZERO=4;static THRESH_TOZERO_INV=5;static THRESH_MODE_THRESHOLD=1;static THRESH_MODE_OTSU=2;static THRESH_MODE_MANUAL=3;static calcThresholdValue(e,t,n,a){let s;switch(a){case R.THRESH_BINARY:s=e<t?0:n;break;case R.THRESH_BINARY_INV:s=e<t?n:0;break;case R.THRESH_TRUNC:s=e<t?e:t;break;case R.THRESH_TOZERO:s=e<t?0:e;break;case R.THRESH_TOZERO_INV:s=e<t?e:0;break}return s}static calcOtsuThreshold(e){let t=new Array(256).fill(0),n=0;e.recycle((o,c,i)=>{let[h,p,l]=o,d=R.rgbToGray(h,p,l);t[Math.floor(d)]++,n++});let a=t.map(o=>o/n),s=0,r=0;for(let o=0;o<256;o++){let c=a.slice(0,o+1).reduce((d,u)=>d+u,0),i=1-c,h=a.slice(0,o+1).map((d,u)=>u*d).reduce((d,u)=>d+u,0),p=a.slice(o+1).map((d,u)=>u*d).reduce((d,u)=>d+u,0),l=c*i*Math.pow(h/c-p/i,2);l>r&&(r=l,s=o)}return s}},N=class R{rows;cols;channels;size;data;constructor(e){this.rows=e.height,this.cols=e.width,this.size={width:e.width,height:e.height},this.channels=4,this.data=e.data}clone(){let{data:e,size:{width:t,height:n}}=this,a=new Uint8ClampedArray(e),s=new ImageData(a,t,n);return new R(s)}delete(){this.data=new Uint8ClampedArray(0)}update(e,t,n,a){let{data:s}=this,[r,o,c,i]=this.getAddress(e,t);switch(n){case"R":s[r]=a;break;case"G":s[o]=a;break;case"B":s[c]=a;break;case"A":s[i]=a;break}}getAddress(e,t){let{channels:n,cols:a}=this,s=a*e*n+t*n;return[s,s+1,s+2,s+3]}recycle(e){let{rows:t,cols:n}=this;for(let a=0;a<t;a++)for(let s=0;s<n;s++)e(this.at(a,s),a,s)}at(e,t){let{data:n}=this,[a,s,r,o]=this.getAddress(e,t);return[n[a],n[s],n[r],n[o]]}imgshow(e,t=!1,n=0,a=0){let s=e instanceof HTMLCanvasElement?e:document.querySelector(e);s||G("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");let{data:r,size:o}=this,{width:c,height:i}=o,h=new ImageData(r,c,i),p=s.getContext("2d");t?(s.width=n,s.height=a,window.createImageBitmap(h,{resizeHeight:a,resizeWidth:n}).then(l=>{p.drawImage(l,0,0)})):(s.width=c,s.height=i,p.putImageData(h,0,0,0,0,s.width,s.height))}toDataUrl(e,t=1){let n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(e??"image/png",t)}toBlob(e,t=1){return new Promise((n,a)=>{let s=document.createElement("canvas");this.imgshow(s),s.toBlob(r=>{if(!r||!r.size)return a(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(r)},e??"image/png",t)})}},Q=new _;return J(X);})();
