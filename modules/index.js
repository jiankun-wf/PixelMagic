var pw=(()=>{var T=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var K=(f,t)=>{for(var e in t)T(f,e,{get:t[e],enumerable:!0})},W=(f,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of z(t))!q.call(f,o)&&o!==e&&T(f,o,{get:()=>t[o],enumerable:!(n=j(t,o))||n.enumerable});return f};var J=f=>W(T({},"__esModule",{value:!0}),f);var X={};K(X,{pw:()=>Q});var g=f=>{throw Error(f)},_=class f{readAsElement(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);let o=n.getImageData(0,0,e.width,e.height);return new G(o)}async readAsDataUrl(t){t||g("no url\uFF01");try{let e=await f.resolveWithUrl(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async readAsData(t){t.size||g("no content blob");let e=URL.createObjectURL(t);try{let n=await f.resolveWithUrl(e);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}static calcResizeLinerFunc(t,e,n,o,r,s){return(1-r)*(1-s)*t+r*(1-s)*e+(1-r)*s*n+r*s*o}RESIZE={INTER_NEAREST:1,INTER_LINEAR:2,INTER_CUBIC:3};resize(t,e,n,o=this.RESIZE.INTER_LINEAR){let r=new ImageData(new Uint8ClampedArray(n*e*4),e,n),s=new G(r),{size:{width:a,height:c}}=t,h=a/e,d=c/n;switch(o){case this.RESIZE.INTER_NEAREST:return s.recycle((M,R,l)=>{let i=Math.round(R*h),u=Math.round(l*d),[m,y,b,A]=t.at(i,u);s.update(R,l,m,y,b,A)}),s;case this.RESIZE.INTER_LINEAR:return s.recycle((M,R,l)=>{let i=(R+.5)*h-.5,u=(l+.5)*d-.5,m=Math.floor(i),y=Math.floor(u),b=Math.ceil(i),A=Math.ceil(u),E=i-m,N=u-y,[w,B,x,p]=t.at(m,y),[I,L,S,C]=t.at(b,y),[O,D,U,v]=t.at(m,A),[H,F,P,Y]=t.at(b,A),k=f.calcResizeLinerFunc(w,I,O,H,E,N),Z=f.calcResizeLinerFunc(B,L,D,F,E,N),$=f.calcResizeLinerFunc(x,S,U,P,E,N),V=f.calcResizeLinerFunc(p,C,v,Y,E,N);s.update(R,l,k,Z,$,V)}),s;case this.RESIZE.INTER_CUBIC:return s.recycle((M,R,l)=>{let i=Math.floor(R*h),u=Math.floor(l*d),m=i-R,y=u-l,b=0,A=0,E=0,N=0;for(let w=-1;w<3;w++)for(let B=-1;B<3;B++){let x=i+w,p=u+B;x=Math.max(x,0),x=Math.min(x,t.rows-1),p=Math.max(p,0),p=Math.min(p,t.cols-1)}}),s}}fade(t,e,n){let r=(e==="in"?1-n:n)*255,s=r,a=r,c=r;switch(e){case"in":t.recycle((h,d,M)=>{let[R,l,i]=h;R+l+i>s+a+c&&t.update(d,M,255,255,255)});break;case"out":t.recycle((h,d,M)=>{let[R,l,i]=h;R+l+i<s+a+c&&t.update(d,M,255,255,255)});break}}native(t,e="#000000"){let n=e.slice(1),[o,r,s]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];t.recycle((a,c,h)=>{let[d,M,R]=a;(d!==255||M!==255||R!==255)&&t.update(c,h,o,r,s)})}nativeRollback(t){let e=[0,0,0,0];t.recycle(n=>{let[o,r,s]=n;if(o!==255||r!==255||s!==255)return e[0]=o,e[1]=r,e[2]=s,"break"}),t.recycle((n,o,r)=>{let[s,a,c]=n;s===e[0]&&a===e[1]&&c===e[2]?t.update(o,r,255,255,255):t.update(o,r,e[0],e[1],e[2])})}dropTransparent(t,e="#FFFFFFff"){let n=e.slice(1),[o,r,s,a]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];t.recycle((c,h,d)=>{c[3]===0&&t.update(h,d,o,r,s,a)})}colorRollback(t){t.recycle((e,n,o)=>{let[r,s,a,c]=e;t.update(n,o,255-r,255-s,255-a,255-c)})}gray(t){t.recycle((e,n,o)=>{let[r,s,a]=e,c=Math.floor(f.rgbToGray(r,s,a));t.update(n,o,c,c,c)})}medianBlur(t,e){e%2!==1&&g("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=-Math.floor(e/2),o=Math.abs(n);t.recycle((r,s,a)=>{let c={R:[],G:[],B:[],A:[]};for(let i=n;i<=o;i++){let u=s+i;if(!(u<0||u>=t.rows))for(let m=n;m<=o;m++){let y=a+m;if(y<0||y>=t.cols)continue;let[b,A,E,N]=t.at(u,y);c.R.push(b),c.G.push(A),c.B.push(E),c.A.push(N)}}c.R.sort((i,u)=>i-u),c.G.sort((i,u)=>i-u),c.B.sort((i,u)=>i-u),c.A.sort((i,u)=>i-u);let h=c.R.length%2!==0,d,M,R,l;if(h){let{R:i,G:u,B:m,A:y}=c,b=Math.floor(i.length/2);d=i[b],M=u[b],R=m[b],l=y[b]}else{let{R:i,G:u,B:m,A:y}=c,b=i.length/2,A=b-1;d=Math.round((i[b]+i[A])/2),M=Math.round((u[b]+u[A])/2),R=Math.round((m[b]+m[A])/2),l=Math.round((y[b]+y[A])/2)}t.update(s,a,d,M,R)})}gaussianBlur(t,e,n=0,o=n){e%2===0&&g("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((e-1)/2-1)+.8),(!o||o===0)&&(o=n);let r=f.calcGaussianKernel(e,n,o);if(!r.length)return;let s=Math.floor(e/2);t.recycle((a,c,h)=>{let d=0,M=0,R=0,l=0;for(let i=0;i<e;i++)for(let u=0;u<e;u++){let m=c+i-s,y=h+u-s;m=Math.max(m,0),m=Math.min(m,t.rows-1),y=Math.max(y,0),y=Math.min(y,t.cols-1);let b=r[i][u],[A,E,N,w]=t.at(m,y);d+=A*b,M+=E*b,R+=N*b,l+=w*b}t.update(c,h,Math.round(d),Math.round(M),Math.round(R),Math.round(l))})}meanBlur(t,e){e%2===0&&g("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");let n=Math.floor(e/2),o=Math.pow(e,2);t.recycle((r,s,a)=>{let c=0,h=0,d=0,M=0;for(let R=0;R<e;R++)for(let l=0;l<e;l++){let i=s+R-n,u=a+l-n;i=Math.max(i,0),i=Math.min(i,t.rows-1),u=Math.max(u,0),u=Math.min(u,t.cols-1);let[m,y,b,A]=t.at(i,u);c+=m,h+=y,d+=b,M+=A}t.update(s,a,Math.round(c/o),Math.round(h/o),Math.round(d/o),Math.round(M/o))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(t,e){if(arguments.length===1||!e?.length){e=new Uint8ClampedArray(256);for(let n=0;n<256;n++)e[n]=Math.min(255,Math.floor(n*f.SATURATION_CONTRAST))}t.recycle((n,o,r)=>{let[s,a,c]=n;t.update(o,r,e[s],e[a],e[c])})}THRESHOLD_TYPE={BINARY:1,BINARY_INV:2,TRUNC:3,TOZERO:4,TOZERO_INV:5};THRESHOLD_MODE={THRESHOLD:1,OTSU:2,MANUAL:3};threshold(t,e,n,o=this.THRESHOLD_TYPE.BINARY,r=this.THRESHOLD_MODE.THRESHOLD){t.recycle((s,a,c)=>{let[h,d,M]=t.at(a,c),R=f.rgbToGray(h,d,M),l;switch(r){case this.THRESHOLD_MODE.THRESHOLD:l=f.calcThresholdValue(R,e,n,o);break;case this.THRESHOLD_MODE.OTSU:l=f.calcThresholdValue(R,f.calcOtsuThreshold(t),n,o);break;case this.THRESHOLD_MODE.MANUAL:l=f.calcThresholdValue(R,e,n,o);break}t.update(a,c,l,l,l)})}dropWhite(t){t.recycle((e,n,o)=>{let[r,s,a,c]=e;r===255&&s===255&&a===255&&c!==0&&t.update(n,o,void 0,void 0,void 0,0)})}groundGlassFilter(t,e=5,n=!0){(!e||e<=0)&&g("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");let{rows:o,cols:r}=t,s=o-e,a=r-e;for(let c=0;c<s;c++)for(let h=0;h<a;h++){let d=Math.floor(Math.random()*e),M=c+d,R=h+(n?d:Math.floor(Math.random()*e)),[l,i,u,m]=t.at(M,R);t.update(c,h,l,i,u,m)}}nostalgiaFilter(t){t.recycle((e,n,o)=>{let[r,s,a]=e,c=Math.min(.393*r+.769*s+.189*a,255),h=Math.min(.349*r+.686*s+.168*a,255),d=Math.min(.272*r+.534*s+.131*a,255);t.update(n,o,c,h,d)})}fleetingFilter(t,e=12){e=Math.round(e),e<=0&&g("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),t.recycle((n,o,r)=>{let s=n[2],a=Math.sqrt(s)*e;t.update(o,r,void 0,void 0,a)})}sunLightFilter(t,e,n,o,r=150){let{rows:s,cols:a}=t;e=e||Math.floor(s/2),n=n||Math.floor(a/2),o=o||Math.min(s,a),t.recycle((c,h,d)=>{let M=Math.pow(e-h,2)+Math.pow(n-d,2);if(M<Math.pow(o,2)){let[R,l,i]=c,u=Math.round(r*(1-Math.sqrt(M)/o));t.update(h,d,Math.min(255,Math.max(0,R+u)),Math.min(255,Math.max(0,l+u)),Math.min(255,Math.max(0,i+u)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(t,e,n){return t*f.GRAY_SCALE_RED+e*f.GRAY_SCALE_GREEN+n*f.GRAY_SCALE_BLUE}static resolveWithUrl(t){return new Promise((e,n)=>{let o=new Image;o.addEventListener("load",()=>{let r=document.createElement("canvas");r.width=o.width,r.height=o.height;let s=r.getContext("2d");s.drawImage(o,0,0,r.width,r.height);let a=s.getImageData(0,0,r.width,r.height);e(new G(a)),o.remove(),r.remove()}),o.addEventListener("error",(...r)=>{n(r[1])}),o.setAttribute("src",t)})}static gaussianFunction(t,e,n,o){let r=-(t*t/(2*n*n)),s=-(e*e/(2*o*o));return 1/(2*Math.PI*n*o)*Math.exp(r+s)}static calcGaussianKernel(t,e,n){let o=[],r=Math.floor(t/2),s=0;for(let a=-r;a<=r;a++){let c=r+a;o[c]=[];for(let h=-r;h<=r;h++){let d=r+h,M=f.gaussianFunction(a,h,e,n);o[c][d]=M,s+=M}}for(let a=0;a<t;a++)for(let c=0;c<t;c++)o[a][c]/=s;return o}static calcThresholdValue(t,e,n,o){let r;switch(o){case 1:r=t<e?0:n;break;case 2:r=t<e?n:0;break;case 3:r=t<e?t:e;break;case 4:r=t<e?0:t;break;case 5:r=t<e?t:0;break}return r}static calcOtsuThreshold(t){let e=new Array(256).fill(0),n=0;t.recycle((a,c,h)=>{let[d,M,R]=a,l=f.rgbToGray(d,M,R);e[Math.floor(l)]++,n++});let o=e.map(a=>a/n),r=0,s=0;for(let a=0;a<256;a++){let c=o.slice(0,a+1).reduce((l,i)=>l+i,0),h=1-c,d=o.slice(0,a+1).map((l,i)=>i*l).reduce((l,i)=>l+i,0),M=o.slice(a+1).map((l,i)=>i*l).reduce((l,i)=>l+i,0),R=c*h*Math.pow(d/c-M/h,2);R>s&&(s=R,r=a)}return r}},G=class f{rows;cols;channels;size;data;constructor(t){this.rows=t.height,this.cols=t.width,this.size={width:t.width,height:t.height},this.channels=4,this.data=t.data}clone(){let{data:t,size:{width:e,height:n}}=this,o=new Uint8ClampedArray(t),r=new ImageData(o,e,n);return new f(r)}delete(){this.data=new Uint8ClampedArray(0)}update(t,e,...n){let{data:o}=this,r=this.getAddress(t,e);for(let s=0;s<4;s++)n[s]!==void 0&&(o[r[s]]=n[s])}getAddress(t,e){let{channels:n,cols:o}=this,r=o*t*n+e*n;return[r,r+1,r+2,r+3]}recycle(t){let{rows:e,cols:n}=this;for(let o=0;o<e;o++)for(let r=0;r<n;r++)t(this.at(o,r),o,r)}at(t,e){let{data:n}=this,[o,r,s,a]=this.getAddress(t,e);return[n[o],n[r],n[s],n[a]]}imgshow(t,e=!1,n=0,o=0){let r=t instanceof HTMLCanvasElement?t:document.querySelector(t);r||g("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");let{data:s,size:a}=this,{width:c,height:h}=a,d=new ImageData(s,c,h),M=r.getContext("2d");e?(r.width=n,r.height=o,window.createImageBitmap(d,{resizeHeight:o,resizeWidth:n}).then(R=>{M.drawImage(R,0,0)})):(r.width=c,r.height=h,M.putImageData(d,0,0,0,0,r.width,r.height))}toDataUrl(t,e=1){let n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(t??"image/png",e)}toBlob(t,e=1){return new Promise((n,o)=>{let r=document.createElement("canvas");this.imgshow(r),r.toBlob(s=>{if(!s||!s.size)return o(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(s)},t??"image/png",e)})}},Q=new _;return J(X);})();
