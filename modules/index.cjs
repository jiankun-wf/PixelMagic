var _=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(B,e)=>{for(var t in e)_(B,t,{get:e[t],enumerable:!0})},X=(B,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of K(e))!J.call(B,a)&&a!==t&&_(B,a,{get:()=>e[a],enumerable:!(n=q(e,a))||n.enumerable});return B};var P=B=>X(_({},"__esModule",{value:!0}),B);var W={};Q(W,{pw:()=>m});module.exports=P(W);const N=B=>{throw Error(B)};class M{readAsElement(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);const a=n.getImageData(0,0,t.width,t.height);return new T(a)}async readAsDataUrl(e){e||N("no url\uFF01");try{const t=await M.resolveWithUrl(e);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}async readAsData(e){e.size||N("no content blob");const t=URL.createObjectURL(e);try{const n=await M.resolveWithUrl(t);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}static calcResizeLinerFunc(e,t,n,a,s,r){return(1-s)*(1-r)*e+s*(1-r)*t+(1-s)*r*n+s*r*a}RESIZE={INTER_NEAREST:1,INTER_LINEAR:2,INTER_CUBIC:3,INTER_AREA:4,INTER_LANCZOS4:5};resize(e,t,n,a=this.RESIZE.INTER_LINEAR){const s=new ImageData(new Uint8ClampedArray(n*t*4),t,n),r=new T(s),{size:{width:o,height:c}}=e,u=o/t,i=c/n;switch(a){case this.RESIZE.INTER_NEAREST:return r.recycle((l,d,R)=>{const h=Math.round(d*u),p=Math.round(R*i),[E,A,b,f]=e.at(h,p);r.update(d,R,"R",E),r.update(d,R,"G",A),r.update(d,R,"B",b),r.update(d,R,"A",f)}),r;case this.RESIZE.INTER_LINEAR:return r.recycle((l,d,R)=>{const h=(d+.5)*u-.5,p=(R+.5)*i-.5,E=Math.floor(h),A=Math.floor(p),b=Math.ceil(h),f=Math.ceil(p),y=h-E,G=p-A,[g,I,S,H]=e.at(E,A),[C,L,x,O]=e.at(b,A),[w,U,D,F]=e.at(E,f),[v,k,Z,Y]=e.at(b,f),V=M.calcResizeLinerFunc(g,C,w,v,y,G),$=M.calcResizeLinerFunc(I,L,U,k,y,G),j=M.calcResizeLinerFunc(S,x,D,Z,y,G),z=M.calcResizeLinerFunc(H,O,F,Y,y,G);r.update(d,R,"R",V),r.update(d,R,"G",$),r.update(d,R,"B",j),r.update(d,R,"A",z)}),r;case this.RESIZE.INTER_CUBIC:return r;case this.RESIZE.INTER_AREA:return r;case this.RESIZE.INTER_LANCZOS4:return r}}fade(e,t,n){const s=(t==="in"?1-n:n)*255,r=s,o=s,c=s;switch(t){case"in":e.recycle((u,i,l)=>{const[d,R,h]=u;d+R+h>r+o+c&&(e.update(i,l,"R",255),e.update(i,l,"G",255),e.update(i,l,"B",255))});break;case"out":e.recycle((u,i,l)=>{const[d,R,h]=u;d+R+h<r+o+c&&(e.update(i,l,"R",255),e.update(i,l,"G",255),e.update(i,l,"B",255))});break}}native(e,t="#000000"){const n=t.slice(1),[a,s,r]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];e.recycle((o,c,u)=>{const[i,l,d]=o;(i!==255||l!==255||d!==255)&&(e.update(c,u,"R",a),e.update(c,u,"G",s),e.update(c,u,"B",r))})}nativeRollback(e){const t=[0,0,0,0];e.recycle(n=>{const[a,s,r]=n;if(a!==255||s!==255||r!==255)return t[0]=a,t[1]=s,t[2]=r,"break"}),e.recycle((n,a,s)=>{const[r,o,c]=n;r===t[0]&&o===t[1]&&c===t[2]?(e.update(a,s,"R",255),e.update(a,s,"G",255),e.update(a,s,"B",255)):(e.update(a,s,"R",t[0]),e.update(a,s,"G",t[1]),e.update(a,s,"B",t[2]))})}dropTransparent(e,t="#FFFFFFff"){const n=t.slice(1),[a,s,r,o]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];e.recycle((c,u,i)=>{c[3]===0&&(e.update(u,i,"R",a),e.update(u,i,"G",s),e.update(u,i,"B",r),e.update(u,i,"A",o))})}colorRollback(e){e.recycle((t,n,a)=>{const[s,r,o,c]=t;e.update(n,a,"R",255-s),e.update(n,a,"G",255-r),e.update(n,a,"B",255-o),e.update(n,a,"A",255-c)})}gray(e){e.recycle((t,n,a)=>{const[s,r,o]=t,c=Math.floor(M.rgbToGray(s,r,o));e.update(n,a,"R",c),e.update(n,a,"G",c),e.update(n,a,"B",c)})}medianBlur(e,t){t%2!==1&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=-Math.floor(t/2),a=Math.abs(n);e.recycle((s,r,o)=>{const c={R:[],G:[],B:[],A:[]};for(let h=n;h<=a;h++){let p=r+h;if(!(p<0||p>=e.rows))for(let E=n;E<=a;E++){let A=o+E;if(A<0||A>=e.cols)continue;const[b,f,y,G]=e.at(p,A);c.R.push(b),c.G.push(f),c.B.push(y),c.A.push(G)}}c.R.sort((h,p)=>h-p),c.G.sort((h,p)=>h-p),c.B.sort((h,p)=>h-p),c.A.sort((h,p)=>h-p);const u=c.R.length%2!==0;let i,l,d,R;if(u){const{R:h,G:p,B:E,A}=c,b=Math.floor(h.length/2);i=h[b],l=p[b],d=E[b],R=A[b]}else{const{R:h,G:p,B:E,A}=c,b=h.length/2,f=b-1;i=Math.round((h[b]+h[f])/2),l=Math.round((p[b]+p[f])/2),d=Math.round((E[b]+E[f])/2),R=Math.round((A[b]+A[f])/2)}e.update(r,o,"R",i),e.update(r,o,"G",l),e.update(r,o,"B",d)})}gaussianBlur(e,t,n=0,a=n){t%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((t-1)/2-1)+.8),(!a||a===0)&&(a=n);const s=M.calcGaussianKernel(t,n,a);if(!s.length)return;const r=Math.floor(t/2);e.recycle((o,c,u)=>{let i=0,l=0,d=0,R=0;for(let h=0;h<t;h++)for(let p=0;p<t;p++){let E=c+h-r,A=u+p-r;E=Math.max(E,0),E=Math.min(E,e.rows-1),A=Math.max(A,0),A=Math.min(A,e.cols-1);const b=s[h][p],[f,y,G,g]=e.at(E,A);i+=f*b,l+=y*b,d+=G*b,R+=g*b}e.update(c,u,"R",Math.round(i)),e.update(c,u,"G",Math.round(l)),e.update(c,u,"B",Math.round(d)),e.update(c,u,"A",Math.round(R))})}meanBlur(e,t){t%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=Math.floor(t/2),a=Math.pow(t,2);e.recycle((s,r,o)=>{let c=0,u=0,i=0,l=0;for(let d=0;d<t;d++)for(let R=0;R<t;R++){let h=r+d-n,p=o+R-n;h=Math.max(h,0),h=Math.min(h,e.rows-1),p=Math.max(p,0),p=Math.min(p,e.cols-1);const[E,A,b,f]=e.at(h,p);c+=E,u+=A,i+=b,l+=f}e.update(r,o,"R",Math.round(c/a)),e.update(r,o,"G",Math.round(u/a)),e.update(r,o,"B",Math.round(i/a)),e.update(r,o,"A",Math.round(l/a))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(e,t){if(arguments.length===1||!t?.length){t=new Uint8ClampedArray(256);for(let n=0;n<256;n++)t[n]=Math.min(255,Math.floor(n*M.SATURATION_CONTRAST))}e.recycle((n,a,s)=>{const[r,o,c]=n;e.update(a,s,"R",t[r]),e.update(a,s,"G",t[o]),e.update(a,s,"B",t[c])})}threshold(e,t,n,a=M.THRESH_BINARY,s=M.THRESH_MODE_THRESHOLD){e.recycle((r,o,c)=>{const[u,i,l]=e.at(o,c),d=M.rgbToGray(u,i,l);let R;switch(s){case M.THRESH_MODE_THRESHOLD:R=M.calcThresholdValue(d,t,n,a);break;case M.THRESH_MODE_OTSU:R=M.calcThresholdValue(d,M.calcOtsuThreshold(e),n,a);break;case M.THRESH_MODE_MANUAL:R=M.calcThresholdValue(d,t,n,a);break}e.update(o,c,"R",R),e.update(o,c,"G",R),e.update(o,c,"B",R)})}dropWhite(e){e.recycle((t,n,a)=>{const[s,r,o,c]=t;s===255&&r===255&&o===255&&c!==0&&e.update(n,a,"A",0)})}groundGlassFilter(e,t=5,n=!0){(!t||t<=0)&&N("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");const{rows:a,cols:s}=e,r=a-t,o=s-t;for(let c=0;c<r;c++)for(let u=0;u<o;u++){const i=Math.floor(Math.random()*t),l=c+i,d=u+(n?i:Math.floor(Math.random()*t)),[R,h,p,E]=e.at(l,d);e.update(c,u,"R",R),e.update(c,u,"G",h),e.update(c,u,"B",p),e.update(c,u,"A",E)}}nostalgiaFilter(e){e.recycle((t,n,a)=>{const[s,r,o]=t,c=Math.min(.393*s+.769*r+.189*o,255),u=Math.min(.349*s+.686*r+.168*o,255),i=Math.min(.272*s+.534*r+.131*o,255);e.update(n,a,"R",c),e.update(n,a,"G",u),e.update(n,a,"B",i)})}fleetingFilter(e,t=12){t=Math.round(t),t<=0&&N("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),e.recycle((n,a,s)=>{const r=n[2],o=Math.sqrt(r)*t;e.update(a,s,"B",o)})}sunLightFilter(e,t,n,a,s=150){const{rows:r,cols:o}=e;t=t||Math.floor(r/2),n=n||Math.floor(o/2),a=a||Math.min(r,o),e.recycle((c,u,i)=>{const l=Math.pow(t-u,2)+Math.pow(n-i,2);if(l<Math.pow(a,2)){const[d,R,h]=c,p=Math.round(s*(1-Math.sqrt(l)/a));e.update(u,i,"R",Math.min(255,Math.max(0,d+p))),e.update(u,i,"G",Math.min(255,Math.max(0,R+p))),e.update(u,i,"B",Math.min(255,Math.max(0,h+p)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(e,t,n){return e*M.GRAY_SCALE_RED+t*M.GRAY_SCALE_GREEN+n*M.GRAY_SCALE_BLUE}static resolveWithUrl(e){return new Promise((t,n)=>{const a=new Image;a.addEventListener("load",()=>{const s=document.createElement("canvas");s.width=a.width,s.height=a.height;const r=s.getContext("2d");r.drawImage(a,0,0,s.width,s.height);const o=r.getImageData(0,0,s.width,s.height);t(new T(o)),a.remove(),s.remove()}),a.addEventListener("error",(...s)=>{n(s[1])}),a.setAttribute("src",e)})}static gaussianFunction(e,t,n,a){const s=-(e*e/(2*n*n)),r=-(t*t/(2*a*a));return 1/(2*Math.PI*n*a)*Math.exp(s+r)}static calcGaussianKernel(e,t,n){const a=[],s=Math.floor(e/2);let r=0;for(let o=-s;o<=s;o++){const c=s+o;a[c]=[];for(let u=-s;u<=s;u++){const i=s+u,l=M.gaussianFunction(o,u,t,n);a[c][i]=l,r+=l}}for(let o=0;o<e;o++)for(let c=0;c<e;c++)a[o][c]/=r;return a}static THRESH_BINARY=1;static THRESH_BINARY_INV=2;static THRESH_TRUNC=3;static THRESH_TOZERO=4;static THRESH_TOZERO_INV=5;static THRESH_MODE_THRESHOLD=1;static THRESH_MODE_OTSU=2;static THRESH_MODE_MANUAL=3;static calcThresholdValue(e,t,n,a){let s;switch(a){case M.THRESH_BINARY:s=e<t?0:n;break;case M.THRESH_BINARY_INV:s=e<t?n:0;break;case M.THRESH_TRUNC:s=e<t?e:t;break;case M.THRESH_TOZERO:s=e<t?0:e;break;case M.THRESH_TOZERO_INV:s=e<t?e:0;break}return s}static calcOtsuThreshold(e){const t=new Array(256).fill(0);let n=0;e.recycle((o,c,u)=>{const[i,l,d]=o,R=M.rgbToGray(i,l,d);t[Math.floor(R)]++,n++});let a=t.map(o=>o/n),s=0,r=0;for(let o=0;o<256;o++){let c=a.slice(0,o+1).reduce((R,h)=>R+h,0),u=1-c,i=a.slice(0,o+1).map((R,h)=>h*R).reduce((R,h)=>R+h,0),l=a.slice(o+1).map((R,h)=>h*R).reduce((R,h)=>R+h,0),d=c*u*Math.pow(i/c-l/u,2);d>r&&(r=d,s=o)}return s}}class T{rows;cols;channels;size;data;constructor(e){this.rows=e.height,this.cols=e.width,this.size={width:e.width,height:e.height},this.channels=4,this.data=e.data}clone(){const{data:e,size:{width:t,height:n}}=this,a=new Uint8ClampedArray(e),s=new ImageData(a,t,n);return new T(s)}delete(){this.data=new Uint8ClampedArray(0)}update(e,t,n,a){const{data:s}=this,[r,o,c,u]=this.getAddress(e,t);switch(n){case"R":s[r]=a;break;case"G":s[o]=a;break;case"B":s[c]=a;break;case"A":s[u]=a;break}}getAddress(e,t){const{channels:n,cols:a}=this,s=a*e*n+t*n;return[s,s+1,s+2,s+3]}recycle(e){const{rows:t,cols:n}=this;for(let a=0;a<t;a++)for(let s=0;s<n;s++)e(this.at(a,s),a,s)}at(e,t){const{data:n}=this,[a,s,r,o]=this.getAddress(e,t);return[n[a],n[s],n[r],n[o]]}imgshow(e,t=!1,n=0,a=0){const s=e instanceof HTMLCanvasElement?e:document.querySelector(e);s||N("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");const{data:r,size:o}=this,{width:c,height:u}=o,i=new ImageData(r,c,u),l=s.getContext("2d");t?(s.width=n,s.height=a,window.createImageBitmap(i,{resizeHeight:a,resizeWidth:n}).then(d=>{l.drawImage(d,0,0)})):(s.width=c,s.height=u,l.putImageData(i,0,0,0,0,s.width,s.height))}toDataUrl(e,t=1){const n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(e??"image/png",t)}toBlob(e,t=1){return new Promise((n,a)=>{const s=document.createElement("canvas");this.imgshow(s),s.toBlob(r=>{if(!r||!r.size)return a(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(r)},e??"image/png",t)})}}const m=new M;
