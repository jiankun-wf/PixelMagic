var _=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var P=(B,t)=>{for(var e in t)_(B,e,{get:t[e],enumerable:!0})},J=(B,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of q(t))!K.call(B,s)&&s!==e&&_(B,s,{get:()=>t[s],enumerable:!(n=j(t,s))||n.enumerable});return B};var Q=B=>J(_({},"__esModule",{value:!0}),B);var W={};P(W,{pw:()=>I});module.exports=Q(W);const N=B=>{throw Error(B)};class y{readAsElement(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height);return new T(s)}async readAsDataUrl(t){t||N("no url\uFF01");try{const e=await y.resolveWithUrl(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async readAsData(t){t.size||N("no content blob");const e=URL.createObjectURL(t);try{const n=await y.resolveWithUrl(e);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}static calcResizeLinerFunc(t,e,n,s,r,a){return(1-r)*(1-a)*t+r*(1-a)*e+(1-r)*a*n+r*a*s}FILP={X:1,Y:2,XY:3};flip(t,e=this.FILP.XY){const{size:n,data:s,rows:r,cols:a}=t,{width:o,height:c}=n,l=new T(new ImageData(new Uint8ClampedArray(r*a*4),o,c)),R=r%2===0?Math.floor(r/2):Math.floor(r/2)+1,M=a%2===0?Math.floor(a/2):Math.floor(a/2)+1;switch(e){case this.FILP.X:return t.recycle((d,h,i)=>{const u=a-i-1,[f,b,m,A]=d,[p,E,g,w]=t.at(h,u);l.update(h,i,p,E,g,w),l.update(h,u,f,b,m,A)},0,r,0,M),l;case this.FILP.Y:return t.recycle((d,h,i)=>{const u=r-h-1,[f,b,m,A]=d,[p,E,g,w]=t.at(u,i);l.update(h,i,p,E,g,w),l.update(u,i,f,b,m,A)},0,R,0,a),l;case this.FILP.XY:return t.recycle((d,h,i)=>{const u=r-h-1,f=a-i-1,[b,m,A,p]=d,[E,g,w,G]=t.at(u,f);l.update(h,i,E,g,w,G),l.update(u,f,b,m,A,p)},0,r,0,M),l}}clip(t,e,n,s,r){const{size:{width:a,height:o}}=t,c=Math.min(e+s,a),l=Math.min(n+r,o),R=Math.max(e,0),M=Math.max(n,0),d=c-R,h=l-M,i=new T(new ImageData(new Uint8ClampedArray(d*h*4),h,d));return i.recycle((u,f,b)=>{const[m,A,p,E]=t.at(f,b);i.update(f,b,m,A,p,E)}),i}RESIZE={INTER_NEAREST:1,INTER_LINEAR:2,INTER_CUBIC:3};resize(t,e,n,s=this.RESIZE.INTER_LINEAR){const r=new ImageData(new Uint8ClampedArray(n*e*4),e,n),a=new T(r),{size:{width:o,height:c}}=t,l=o/e,R=c/n;switch(s){case this.RESIZE.INTER_NEAREST:return a.recycle((M,d,h)=>{const i=Math.round(d*l),u=Math.round(h*R),[f,b,m,A]=t.at(i,u);a.update(d,h,f,b,m,A)}),a;case this.RESIZE.INTER_LINEAR:return a.recycle((M,d,h)=>{const i=(d+.5)*l-.5,u=(h+.5)*R-.5,f=Math.floor(i),b=Math.floor(u),m=Math.ceil(i),A=Math.ceil(u),p=i-f,E=u-b,[g,w,G,x]=t.at(f,b),[L,C,S,D]=t.at(m,b),[O,U,H,v]=t.at(f,A),[F,Y,X,k]=t.at(m,A),z=y.calcResizeLinerFunc(g,L,O,F,p,E),Z=y.calcResizeLinerFunc(w,C,U,Y,p,E),$=y.calcResizeLinerFunc(G,S,H,X,p,E),V=y.calcResizeLinerFunc(x,D,v,k,p,E);a.update(d,h,z,Z,$,V)}),a;case this.RESIZE.INTER_CUBIC:return a.recycle((M,d,h)=>{const i=Math.floor(d*l),u=Math.floor(h*R),f=i-d,b=u-h;let m=0,A=0,p=0,E=0;for(let g=-1;g<3;g++)for(let w=-1;w<3;w++){let G=i+g,x=u+w;G=Math.max(G,0),G=Math.min(G,t.rows-1),x=Math.max(x,0),x=Math.min(x,t.cols-1)}}),a}}fade(t,e,n){const r=(e==="in"?1-n:n)*255,a=r,o=r,c=r;switch(e){case"in":t.recycle((l,R,M)=>{const[d,h,i]=l;d+h+i>a+o+c&&t.update(R,M,255,255,255)});break;case"out":t.recycle((l,R,M)=>{const[d,h,i]=l;d+h+i<a+o+c&&t.update(R,M,255,255,255)});break}}native(t,e="#000000"){const n=e.slice(1),[s,r,a]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];t.recycle((o,c,l)=>{const[R,M,d]=o;(R!==255||M!==255||d!==255)&&t.update(c,l,s,r,a)})}nativeRollback(t){const e=[0,0,0,0];t.recycle(n=>{const[s,r,a]=n;if(s!==255||r!==255||a!==255)return e[0]=s,e[1]=r,e[2]=a,"break"}),t.recycle((n,s,r)=>{const[a,o,c]=n;a===e[0]&&o===e[1]&&c===e[2]?t.update(s,r,255,255,255):t.update(s,r,e[0],e[1],e[2])})}dropTransparent(t,e="#FFFFFFff"){const n=e.slice(1),[s,r,a,o]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];t.recycle((c,l,R)=>{c[3]===0&&t.update(l,R,s,r,a,o)})}colorRollback(t){t.recycle((e,n,s)=>{const[r,a,o,c]=e;t.update(n,s,255-r,255-a,255-o,255-c)})}gray(t){t.recycle((e,n,s)=>{const[r,a,o]=e,c=Math.floor(y.rgbToGray(r,a,o));t.update(n,s,c,c,c)})}medianBlur(t,e){e%2!==1&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=-Math.floor(e/2),s=Math.abs(n);t.recycle((r,a,o)=>{const c={R:[],G:[],B:[],A:[]};for(let i=n;i<=s;i++){let u=a+i;if(!(u<0||u>=t.rows))for(let f=n;f<=s;f++){let b=o+f;if(b<0||b>=t.cols)continue;const[m,A,p,E]=t.at(u,b);c.R.push(m),c.G.push(A),c.B.push(p),c.A.push(E)}}c.R.sort((i,u)=>i-u),c.G.sort((i,u)=>i-u),c.B.sort((i,u)=>i-u),c.A.sort((i,u)=>i-u);const l=c.R.length%2!==0;let R,M,d,h;if(l){const{R:i,G:u,B:f,A:b}=c,m=Math.floor(i.length/2);R=i[m],M=u[m],d=f[m],h=b[m]}else{const{R:i,G:u,B:f,A:b}=c,m=i.length/2,A=m-1;R=Math.round((i[m]+i[A])/2),M=Math.round((u[m]+u[A])/2),d=Math.round((f[m]+f[A])/2),h=Math.round((b[m]+b[A])/2)}t.update(a,o,R,M,d)})}gaussianBlur(t,e,n=0,s=n){e%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((e-1)/2-1)+.8),(!s||s===0)&&(s=n);const r=y.calcGaussianKernel(e,n,s);if(!r.length)return;const a=Math.floor(e/2);t.recycle((o,c,l)=>{let R=0,M=0,d=0,h=0;for(let i=0;i<e;i++)for(let u=0;u<e;u++){let f=c+i-a,b=l+u-a;f=Math.max(f,0),f=Math.min(f,t.rows-1),b=Math.max(b,0),b=Math.min(b,t.cols-1);const m=r[i][u],[A,p,E,g]=t.at(f,b);R+=A*m,M+=p*m,d+=E*m,h+=g*m}t.update(c,l,Math.round(R),Math.round(M),Math.round(d),Math.round(h))})}meanBlur(t,e){e%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=Math.floor(e/2),s=Math.pow(e,2);t.recycle((r,a,o)=>{let c=0,l=0,R=0,M=0;for(let d=0;d<e;d++)for(let h=0;h<e;h++){let i=a+d-n,u=o+h-n;i=Math.max(i,0),i=Math.min(i,t.rows-1),u=Math.max(u,0),u=Math.min(u,t.cols-1);const[f,b,m,A]=t.at(i,u);c+=f,l+=b,R+=m,M+=A}t.update(a,o,Math.round(c/s),Math.round(l/s),Math.round(R/s),Math.round(M/s))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(t,e){if(arguments.length===1||!e?.length){e=new Uint8ClampedArray(256);for(let n=0;n<256;n++)e[n]=Math.min(255,Math.floor(n*y.SATURATION_CONTRAST))}t.recycle((n,s,r)=>{const[a,o,c]=n;t.update(s,r,e[a],e[o],e[c])})}THRESHOLD_TYPE={BINARY:1,BINARY_INV:2,TRUNC:3,TOZERO:4,TOZERO_INV:5};THRESHOLD_MODE={THRESHOLD:1,OTSU:2,MANUAL:3};threshold(t,e,n,s=this.THRESHOLD_TYPE.BINARY,r=this.THRESHOLD_MODE.THRESHOLD){t.recycle((a,o,c)=>{const[l,R,M]=t.at(o,c),d=y.rgbToGray(l,R,M);let h;switch(r){case this.THRESHOLD_MODE.THRESHOLD:h=y.calcThresholdValue(d,e,n,s);break;case this.THRESHOLD_MODE.OTSU:h=y.calcThresholdValue(d,y.calcOtsuThreshold(t),n,s);break;case this.THRESHOLD_MODE.MANUAL:h=y.calcThresholdValue(d,e,n,s);break}t.update(o,c,h,h,h)})}dropWhite(t){t.recycle((e,n,s)=>{const[r,a,o,c]=e;r===255&&a===255&&o===255&&c!==0&&t.update(n,s,void 0,void 0,void 0,0)})}groundGlassFilter(t,e=5,n=!0){(!e||e<=0)&&N("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");const{rows:s,cols:r}=t,a=s-e,o=r-e;for(let c=0;c<a;c++)for(let l=0;l<o;l++){const R=Math.floor(Math.random()*e),M=c+R,d=l+(n?R:Math.floor(Math.random()*e)),[h,i,u,f]=t.at(M,d);t.update(c,l,h,i,u,f)}}nostalgiaFilter(t){t.recycle((e,n,s)=>{const[r,a,o]=e,c=Math.min(.393*r+.769*a+.189*o,255),l=Math.min(.349*r+.686*a+.168*o,255),R=Math.min(.272*r+.534*a+.131*o,255);t.update(n,s,c,l,R)})}fleetingFilter(t,e=12){e=Math.round(e),e<=0&&N("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),t.recycle((n,s,r)=>{const a=n[2],o=Math.sqrt(a)*e;t.update(s,r,void 0,void 0,o)})}sunLightFilter(t,e,n,s,r=150){const{rows:a,cols:o}=t;e=e||Math.floor(a/2),n=n||Math.floor(o/2),s=s||Math.min(a,o),t.recycle((c,l,R)=>{const M=Math.pow(e-l,2)+Math.pow(n-R,2);if(M<Math.pow(s,2)){const[d,h,i]=c,u=Math.round(r*(1-Math.sqrt(M)/s));t.update(l,R,Math.min(255,Math.max(0,d+u)),Math.min(255,Math.max(0,h+u)),Math.min(255,Math.max(0,i+u)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(t,e,n){return t*y.GRAY_SCALE_RED+e*y.GRAY_SCALE_GREEN+n*y.GRAY_SCALE_BLUE}static resolveWithUrl(t){return new Promise((e,n)=>{const s=new Image;s.addEventListener("load",()=>{const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const a=r.getContext("2d");a.drawImage(s,0,0,r.width,r.height);const o=a.getImageData(0,0,r.width,r.height);e(new T(o)),s.remove(),r.remove()}),s.addEventListener("error",(...r)=>{n(r[1])}),s.setAttribute("src",t)})}static gaussianFunction(t,e,n,s){const r=-(t*t/(2*n*n)),a=-(e*e/(2*s*s));return 1/(2*Math.PI*n*s)*Math.exp(r+a)}static calcGaussianKernel(t,e,n){const s=[],r=Math.floor(t/2);let a=0;for(let o=-r;o<=r;o++){const c=r+o;s[c]=[];for(let l=-r;l<=r;l++){const R=r+l,M=y.gaussianFunction(o,l,e,n);s[c][R]=M,a+=M}}for(let o=0;o<t;o++)for(let c=0;c<t;c++)s[o][c]/=a;return s}static calcThresholdValue(t,e,n,s){let r;switch(s){case 1:r=t<e?0:n;break;case 2:r=t<e?n:0;break;case 3:r=t<e?t:e;break;case 4:r=t<e?0:t;break;case 5:r=t<e?t:0;break}return r}static calcOtsuThreshold(t){const e=new Array(256).fill(0);let n=0;t.recycle((o,c,l)=>{const[R,M,d]=o,h=y.rgbToGray(R,M,d);e[Math.floor(h)]++,n++});let s=e.map(o=>o/n),r=0,a=0;for(let o=0;o<256;o++){let c=s.slice(0,o+1).reduce((h,i)=>h+i,0),l=1-c,R=s.slice(0,o+1).map((h,i)=>i*h).reduce((h,i)=>h+i,0),M=s.slice(o+1).map((h,i)=>i*h).reduce((h,i)=>h+i,0),d=c*l*Math.pow(R/c-M/l,2);d>a&&(a=d,r=o)}return r}}class T{rows;cols;channels;size;data;constructor(t){this.rows=t.height,this.cols=t.width,this.size={width:t.width,height:t.height},this.channels=4,this.data=t.data}clone(){const{data:t,size:{width:e,height:n}}=this,s=new Uint8ClampedArray(t),r=new ImageData(s,e,n);return new T(r)}delete(){this.data=new Uint8ClampedArray(0)}update(t,e,...n){const{data:s}=this,r=this.getAddress(t,e);for(let a=0;a<4;a++)n[a]!==void 0&&(s[r[a]]=n[a])}getAddress(t,e){const{channels:n,cols:s}=this,r=s*t*n+e*n;return[r,r+1,r+2,r+3]}recycle(t,e=0,n=this.rows,s=0,r=this.cols){for(let a=e;a<n;a++)for(let o=s;o<r;o++)t(this.at(a,o),a,o)}at(t,e){const{data:n}=this,[s,r,a,o]=this.getAddress(t,e);return[n[s],n[r],n[a],n[o]]}imgshow(t,e=!1,n=0,s=0){const r=t instanceof HTMLCanvasElement?t:document.querySelector(t);r||N("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");const{data:a,size:o}=this,{width:c,height:l}=o,R=new ImageData(a,c,l),M=r.getContext("2d");e?(r.width=n,r.height=s,window.createImageBitmap(R,{resizeHeight:s,resizeWidth:n}).then(d=>{M.drawImage(d,0,0)})):(r.width=c,r.height=l,M.putImageData(R,0,0,0,0,r.width,r.height))}toDataUrl(t,e=1){const n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(t??"image/png",e)}toBlob(t,e=1){return new Promise((n,s)=>{const r=document.createElement("canvas");this.imgshow(r),r.toBlob(a=>{if(!a||!a.size)return s(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(a)},t??"image/png",e)})}}const I=new y;
