var _=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var J=(w,t)=>{for(var e in t)_(w,e,{get:t[e],enumerable:!0})},Q=(w,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of K(t))!X.call(w,o)&&o!==e&&_(w,o,{get:()=>t[o],enumerable:!(n=q(t,o))||n.enumerable});return w};var P=w=>Q(_({},"__esModule",{value:!0}),w);var W={};J(W,{pw:()=>I});module.exports=P(W);const N=w=>{throw Error(w)};class A{readAsElement(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);const o=n.getImageData(0,0,e.width,e.height);return new T(o)}async readAsDataUrl(t){t||N("no url\uFF01");try{const e=await A.resolveWithUrl(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}async readAsData(t){t.size||N("no content blob");const e=URL.createObjectURL(t);try{const n=await A.resolveWithUrl(e);return Promise.resolve(n)}catch(n){return Promise.reject(n)}}static calcResizeLinerFunc(t,e,n,o,r,a){return(1-r)*(1-a)*t+r*(1-a)*e+(1-r)*a*n+r*a*o}clip(t,e,n,o,r){const{size:{width:a,height:s}}=t,c=Math.min(e+o,a),u=Math.min(n+r,s),M=Math.max(e,0),R=Math.max(n,0),d=c-M,l=u-R,i=new T(new ImageData(new Uint8ClampedArray(d*l*4).fill(0),l,d));for(let h=0;h<d;h++)for(let m=0;m<l;m++){const[b,f,y,E]=t.at(h,m);i.update(h,m,b,f,y,E)}return i}RESIZE={INTER_NEAREST:1,INTER_LINEAR:2,INTER_CUBIC:3};resize(t,e,n,o=this.RESIZE.INTER_LINEAR){const r=new ImageData(new Uint8ClampedArray(n*e*4),e,n),a=new T(r),{size:{width:s,height:c}}=t,u=s/e,M=c/n;switch(o){case this.RESIZE.INTER_NEAREST:return a.recycle((R,d,l)=>{const i=Math.round(d*u),h=Math.round(l*M),[m,b,f,y]=t.at(i,h);a.update(d,l,m,b,f,y)}),a;case this.RESIZE.INTER_LINEAR:return a.recycle((R,d,l)=>{const i=(d+.5)*u-.5,h=(l+.5)*M-.5,m=Math.floor(i),b=Math.floor(h),f=Math.ceil(i),y=Math.ceil(h),E=i-m,g=h-b,[p,x,B,G]=t.at(m,b),[L,S,C,D]=t.at(f,b),[O,U,H,v]=t.at(m,y),[F,Y,k,Z]=t.at(f,y),$=A.calcResizeLinerFunc(p,L,O,F,E,g),j=A.calcResizeLinerFunc(x,S,U,Y,E,g),z=A.calcResizeLinerFunc(B,C,H,k,E,g),V=A.calcResizeLinerFunc(G,D,v,Z,E,g);a.update(d,l,$,j,z,V)}),a;case this.RESIZE.INTER_CUBIC:return a.recycle((R,d,l)=>{const i=Math.floor(d*u),h=Math.floor(l*M),m=i-d,b=h-l;let f=0,y=0,E=0,g=0;for(let p=-1;p<3;p++)for(let x=-1;x<3;x++){let B=i+p,G=h+x;B=Math.max(B,0),B=Math.min(B,t.rows-1),G=Math.max(G,0),G=Math.min(G,t.cols-1)}}),a}}fade(t,e,n){const r=(e==="in"?1-n:n)*255,a=r,s=r,c=r;switch(e){case"in":t.recycle((u,M,R)=>{const[d,l,i]=u;d+l+i>a+s+c&&t.update(M,R,255,255,255)});break;case"out":t.recycle((u,M,R)=>{const[d,l,i]=u;d+l+i<a+s+c&&t.update(M,R,255,255,255)});break}}native(t,e="#000000"){const n=e.slice(1),[o,r,a]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`];t.recycle((s,c,u)=>{const[M,R,d]=s;(M!==255||R!==255||d!==255)&&t.update(c,u,o,r,a)})}nativeRollback(t){const e=[0,0,0,0];t.recycle(n=>{const[o,r,a]=n;if(o!==255||r!==255||a!==255)return e[0]=o,e[1]=r,e[2]=a,"break"}),t.recycle((n,o,r)=>{const[a,s,c]=n;a===e[0]&&s===e[1]&&c===e[2]?t.update(o,r,255,255,255):t.update(o,r,e[0],e[1],e[2])})}dropTransparent(t,e="#FFFFFFff"){const n=e.slice(1),[o,r,a,s]=[+`0x${n.slice(0,2)}`,+`0x${n.slice(2,4)}`,+`0x${n.slice(4,6)}`,n.length>=8?+`0x${n.slice(6,8)}`:255];t.recycle((c,u,M)=>{c[3]===0&&t.update(u,M,o,r,a,s)})}colorRollback(t){t.recycle((e,n,o)=>{const[r,a,s,c]=e;t.update(n,o,255-r,255-a,255-s,255-c)})}gray(t){t.recycle((e,n,o)=>{const[r,a,s]=e,c=Math.floor(A.rgbToGray(r,a,s));t.update(n,o,c,c,c)})}medianBlur(t,e){e%2!==1&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=-Math.floor(e/2),o=Math.abs(n);t.recycle((r,a,s)=>{const c={R:[],G:[],B:[],A:[]};for(let i=n;i<=o;i++){let h=a+i;if(!(h<0||h>=t.rows))for(let m=n;m<=o;m++){let b=s+m;if(b<0||b>=t.cols)continue;const[f,y,E,g]=t.at(h,b);c.R.push(f),c.G.push(y),c.B.push(E),c.A.push(g)}}c.R.sort((i,h)=>i-h),c.G.sort((i,h)=>i-h),c.B.sort((i,h)=>i-h),c.A.sort((i,h)=>i-h);const u=c.R.length%2!==0;let M,R,d,l;if(u){const{R:i,G:h,B:m,A:b}=c,f=Math.floor(i.length/2);M=i[f],R=h[f],d=m[f],l=b[f]}else{const{R:i,G:h,B:m,A:b}=c,f=i.length/2,y=f-1;M=Math.round((i[f]+i[y])/2),R=Math.round((h[f]+h[y])/2),d=Math.round((m[f]+m[y])/2),l=Math.round((b[f]+b[y])/2)}t.update(a,s,M,R,d)})}gaussianBlur(t,e,n=0,o=n){e%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01"),(!n||n===0)&&(n=.3*((e-1)/2-1)+.8),(!o||o===0)&&(o=n);const r=A.calcGaussianKernel(e,n,o);if(!r.length)return;const a=Math.floor(e/2);t.recycle((s,c,u)=>{let M=0,R=0,d=0,l=0;for(let i=0;i<e;i++)for(let h=0;h<e;h++){let m=c+i-a,b=u+h-a;m=Math.max(m,0),m=Math.min(m,t.rows-1),b=Math.max(b,0),b=Math.min(b,t.cols-1);const f=r[i][h],[y,E,g,p]=t.at(m,b);M+=y*f,R+=E*f,d+=g*f,l+=p*f}t.update(c,u,Math.round(M),Math.round(R),Math.round(d),Math.round(l))})}meanBlur(t,e){e%2===0&&N("size\u9700\u4E3A\u5947\u6574\u6570\uFF01");const n=Math.floor(e/2),o=Math.pow(e,2);t.recycle((r,a,s)=>{let c=0,u=0,M=0,R=0;for(let d=0;d<e;d++)for(let l=0;l<e;l++){let i=a+d-n,h=s+l-n;i=Math.max(i,0),i=Math.min(i,t.rows-1),h=Math.max(h,0),h=Math.min(h,t.cols-1);const[m,b,f,y]=t.at(i,h);c+=m,u+=b,M+=f,R+=y}t.update(a,s,Math.round(c/o),Math.round(u/o),Math.round(M/o),Math.round(R/o))})}static LINER_CONTRAST=1.5;static BRIGHTNESS_CONTRAST=50;static SATURATION_CONTRAST=1.5;LUT(t,e){if(arguments.length===1||!e?.length){e=new Uint8ClampedArray(256);for(let n=0;n<256;n++)e[n]=Math.min(255,Math.floor(n*A.SATURATION_CONTRAST))}t.recycle((n,o,r)=>{const[a,s,c]=n;t.update(o,r,e[a],e[s],e[c])})}THRESHOLD_TYPE={BINARY:1,BINARY_INV:2,TRUNC:3,TOZERO:4,TOZERO_INV:5};THRESHOLD_MODE={THRESHOLD:1,OTSU:2,MANUAL:3};threshold(t,e,n,o=this.THRESHOLD_TYPE.BINARY,r=this.THRESHOLD_MODE.THRESHOLD){t.recycle((a,s,c)=>{const[u,M,R]=t.at(s,c),d=A.rgbToGray(u,M,R);let l;switch(r){case this.THRESHOLD_MODE.THRESHOLD:l=A.calcThresholdValue(d,e,n,o);break;case this.THRESHOLD_MODE.OTSU:l=A.calcThresholdValue(d,A.calcOtsuThreshold(t),n,o);break;case this.THRESHOLD_MODE.MANUAL:l=A.calcThresholdValue(d,e,n,o);break}t.update(s,c,l,l,l)})}dropWhite(t){t.recycle((e,n,o)=>{const[r,a,s,c]=e;r===255&&a===255&&s===255&&c!==0&&t.update(n,o,void 0,void 0,void 0,0)})}groundGlassFilter(t,e=5,n=!0){(!e||e<=0)&&N("offset \u9700\u4E3A\u6B63\u6574\u6570\uFF01");const{rows:o,cols:r}=t,a=o-e,s=r-e;for(let c=0;c<a;c++)for(let u=0;u<s;u++){const M=Math.floor(Math.random()*e),R=c+M,d=u+(n?M:Math.floor(Math.random()*e)),[l,i,h,m]=t.at(R,d);t.update(c,u,l,i,h,m)}}nostalgiaFilter(t){t.recycle((e,n,o)=>{const[r,a,s]=e,c=Math.min(.393*r+.769*a+.189*s,255),u=Math.min(.349*r+.686*a+.168*s,255),M=Math.min(.272*r+.534*a+.131*s,255);t.update(n,o,c,u,M)})}fleetingFilter(t,e=12){e=Math.round(e),e<=0&&N("\u56E0\u5B50\u5FC5\u987B\u5927\u4E8E0"),t.recycle((n,o,r)=>{const a=n[2],s=Math.sqrt(a)*e;t.update(o,r,void 0,void 0,s)})}sunLightFilter(t,e,n,o,r=150){const{rows:a,cols:s}=t;e=e||Math.floor(a/2),n=n||Math.floor(s/2),o=o||Math.min(a,s),t.recycle((c,u,M)=>{const R=Math.pow(e-u,2)+Math.pow(n-M,2);if(R<Math.pow(o,2)){const[d,l,i]=c,h=Math.round(r*(1-Math.sqrt(R)/o));t.update(u,M,Math.min(255,Math.max(0,d+h)),Math.min(255,Math.max(0,l+h)),Math.min(255,Math.max(0,i+h)))}})}static GRAY_SCALE_RED=.2989;static GRAY_SCALE_GREEN=.587;static GRAY_SCALE_BLUE=.114;static rgbToGray(t,e,n){return t*A.GRAY_SCALE_RED+e*A.GRAY_SCALE_GREEN+n*A.GRAY_SCALE_BLUE}static resolveWithUrl(t){return new Promise((e,n)=>{const o=new Image;o.addEventListener("load",()=>{const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const a=r.getContext("2d");a.drawImage(o,0,0,r.width,r.height);const s=a.getImageData(0,0,r.width,r.height);e(new T(s)),o.remove(),r.remove()}),o.addEventListener("error",(...r)=>{n(r[1])}),o.setAttribute("src",t)})}static gaussianFunction(t,e,n,o){const r=-(t*t/(2*n*n)),a=-(e*e/(2*o*o));return 1/(2*Math.PI*n*o)*Math.exp(r+a)}static calcGaussianKernel(t,e,n){const o=[],r=Math.floor(t/2);let a=0;for(let s=-r;s<=r;s++){const c=r+s;o[c]=[];for(let u=-r;u<=r;u++){const M=r+u,R=A.gaussianFunction(s,u,e,n);o[c][M]=R,a+=R}}for(let s=0;s<t;s++)for(let c=0;c<t;c++)o[s][c]/=a;return o}static calcThresholdValue(t,e,n,o){let r;switch(o){case 1:r=t<e?0:n;break;case 2:r=t<e?n:0;break;case 3:r=t<e?t:e;break;case 4:r=t<e?0:t;break;case 5:r=t<e?t:0;break}return r}static calcOtsuThreshold(t){const e=new Array(256).fill(0);let n=0;t.recycle((s,c,u)=>{const[M,R,d]=s,l=A.rgbToGray(M,R,d);e[Math.floor(l)]++,n++});let o=e.map(s=>s/n),r=0,a=0;for(let s=0;s<256;s++){let c=o.slice(0,s+1).reduce((l,i)=>l+i,0),u=1-c,M=o.slice(0,s+1).map((l,i)=>i*l).reduce((l,i)=>l+i,0),R=o.slice(s+1).map((l,i)=>i*l).reduce((l,i)=>l+i,0),d=c*u*Math.pow(M/c-R/u,2);d>a&&(a=d,r=s)}return r}}class T{rows;cols;channels;size;data;constructor(t){this.rows=t.height,this.cols=t.width,this.size={width:t.width,height:t.height},this.channels=4,this.data=t.data}clone(){const{data:t,size:{width:e,height:n}}=this,o=new Uint8ClampedArray(t),r=new ImageData(o,e,n);return new T(r)}delete(){this.data=new Uint8ClampedArray(0)}update(t,e,...n){const{data:o}=this,r=this.getAddress(t,e);for(let a=0;a<4;a++)n[a]!==void 0&&(o[r[a]]=n[a])}getAddress(t,e){const{channels:n,cols:o}=this,r=o*t*n+e*n;return[r,r+1,r+2,r+3]}recycle(t){const{rows:e,cols:n}=this;for(let o=0;o<e;o++)for(let r=0;r<n;r++)t(this.at(o,r),o,r)}at(t,e){const{data:n}=this,[o,r,a,s]=this.getAddress(t,e);return[n[o],n[r],n[a],n[s]]}imgshow(t,e=!1,n=0,o=0){const r=t instanceof HTMLCanvasElement?t:document.querySelector(t);r||N("\u65E0\u6CD5\u627E\u5230canvas\u5F53\u524D\u5143\u7D20\uFF01");const{data:a,size:s}=this,{width:c,height:u}=s,M=new ImageData(a,c,u),R=r.getContext("2d");e?(r.width=n,r.height=o,window.createImageBitmap(M,{resizeHeight:o,resizeWidth:n}).then(d=>{R.drawImage(d,0,0)})):(r.width=c,r.height=u,R.putImageData(M,0,0,0,0,r.width,r.height))}toDataUrl(t,e=1){const n=document.createElement("canvas");return this.imgshow(n),n.toDataURL(t??"image/png",e)}toBlob(t,e=1){return new Promise((n,o)=>{const r=document.createElement("canvas");this.imgshow(r),r.toBlob(a=>{if(!a||!a.size)return o(new Error("\u8F6C\u6362\u5931\u8D25\uFF1A\u4E0D\u5B58\u5728\u7684blob\u6216blob\u5927\u5C0F\u4E3A\u7A7A"));n(a)},t??"image/png",e)})}}const I=new A;
